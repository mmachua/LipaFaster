{% extends "base.html" %}
{% block body %}
  <div class="container">
    <h1>Welcome to my website!</h1>
    <p>Click the button below to test the M-Pesa API:</p>

    {% if message %}
        <p>{{ message }}</p>
    {% endif %}
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="pdf_file">
        <button type="submit">Convert to Image and Download</button>
    </form>
  </div>
{% endblock body %}

<!-- { % block body %}
  <div class="container">
    <h1>Welcome to my website!</h1>
    <p>Click the button below to test the M-Pesa API:</p>



    {% if message %}
        <p>{{ message }}</p>
    {% endif %}
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="pdf_file">
        <button type="submit">Convert to Image and Download</button>
    </form>







<!-






    <form id="mpesa-form" method="POST">
      {% csrf_token %}
      <div class="form-group">
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" required>
      </div>
      <div class="form-group">
        <label for="phone_number">Phone Number:</label>
        <input type="tel" id="phone_number" name="phone_number" required>
      </div>
      <button type="submit" class="btn btn-primary">Test M-Pesa API</button>
    </form>
    {% if message %}
      <div class="alert alert-info mt-3">
        {{ message }}
      </div>
    {% endif %} ->
  </div>
{ % endblock body %} -->

{% block javascript %}
  <script>
    const form = document.querySelector('#mpesa-form');
    const responseContainer = document.querySelector('#response-container');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const amount = form.elements['amount'].value;
      const phone_number = form.elements['phone_number'].value;
      const response = await fetch('/test-mpesa', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
        },
        body: new URLSearchParams({
          'csrfmiddlewaretoken': '{{ csrf_token }}',
          'amount': amount,
          'phone_number': phone_number
        })
      });

      const data = await response.json();

      if (data.status === 'success') {
        responseContainer.innerHTML = `<div class="alert alert-success mt-3">${data.message}</div>`;
      } else {
        responseContainer.innerHTML = `<div class="alert alert-danger mt-3">${data.message}</div>`;
      }
    });
  </script>
{% endblock %}
